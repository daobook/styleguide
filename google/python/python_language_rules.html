<!doctype html>
<html class="no-js" lang="zh_CN">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="author" title="关于这些文档" href="../../about.html" /><link rel="index" title="索引" href="../../genindex.html" /><link rel="search" title="搜索" href="../../search.html" /><link rel="next" title="3. Python 风格规范" href="python_style_rules.html" /><link rel="prev" title="1. 背景" href="background.html" />

    <meta name="generator" content="sphinx-4.3.0, furo 2021.11.16"/>
        <title>2. Python语言规范 - Style Guide 0.0.1 文档</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=916d6ed8f59335acffa15474ff504849343d4c76" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=0af69da206d614734f649b27d4cdc2dd6c31f41d" />
    <link rel="stylesheet" type="text/css" href="../../_static/default.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  body[data-theme="dark"] {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
  @media (prefers-color-scheme: dark) {
    body:not([data-theme="light"]) {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }
</style></head>
  <body>
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" />
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Style Guide 0.0.1 文档</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">Style Guide 0.0.1 文档</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder=搜索 name="q" aria-label="搜索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">导航</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">谷歌风格指南</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../docguide/index.html">谷歌文档指南</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../docguide/style.html">1. Markdown style guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docguide/best_practices.html">2. Documentation Best Practices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docguide/READMEs.html">3. README.md files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docguide/philosophy.html">4. Philosophy</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../html-css/index.html">HTML/CSS 风格指南</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../html-css/general/index.html">1. 通用</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../html-css/general/style-rules.html">1.1. 通用样式规则</a></li>
<li class="toctree-l4"><a class="reference internal" href="../html-css/general/formatting-rules.html">1.2. 通用排版规则</a></li>
<li class="toctree-l4"><a class="reference internal" href="../html-css/general/meta-rules.html">1.3. 通用文档级元数据规则</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../html-css/html/index.html">2. HTML</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../html-css/html/style-rules.html">2.1. HTML 样式规则</a></li>
<li class="toctree-l4"><a class="reference internal" href="../html-css/html/formatting-rules.html">2.2. HTML 格式规则</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../html-css/css/index.html">3. CSS</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../html-css/css/style-rules.html">3.1. CSS 样式规则</a></li>
<li class="toctree-l4"><a class="reference internal" href="../html-css/css/formatting-rules.html">3.2. CSS格式化规则</a></li>
<li class="toctree-l4"><a class="reference internal" href="../html-css/css/meta-rules.html">3.3. CSS 元数据规则</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../html-css/parting_words.html">4. 赠言</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="index.html">Python 风格指南</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="background.html">1. 背景</a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">2. Python语言规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="python_style_rules.html">3. Python 风格规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="parting_words.html">4. 临别赠言</a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog.html">5. 变更日志</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../cpp/index.html">C++ 风格指南</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../cpp/headers.html">1. 头文件</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cpp/scoping.html">2. 作用域</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cpp/classes.html">3. 类</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cpp/functions.html">4. 函数</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cpp/magic.html">5. 来自 Google 的奇技</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cpp/others.html">6. 其他 C++ 特性</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cpp/naming.html">7. 命名约定</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cpp/comments.html">8. 注释</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cpp/formatting.html">9. 格式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cpp/exceptions.html">10. 规则特例</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cpp/end.html">11. 结束语</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cpp/changelog.html">12. 变更日志</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../shell/index.html">Shell 风格指南</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../shell/background.html">1. 背景</a></li>
<li class="toctree-l3"><a class="reference internal" href="../shell/shell_files_and_interpreter_invocation.html">2. Shell文件和解释器调用</a></li>
<li class="toctree-l3"><a class="reference internal" href="../shell/environment.html">3. 环境</a></li>
<li class="toctree-l3"><a class="reference internal" href="../shell/comments.html">4. 注释</a></li>
<li class="toctree-l3"><a class="reference internal" href="../shell/formatting.html">5. 格式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../shell/features_and_bugs.html">6. 特性及错误</a></li>
<li class="toctree-l3"><a class="reference internal" href="../shell/naming_conventions.html">7. 命名约定</a></li>
<li class="toctree-l3"><a class="reference internal" href="../shell/calling_commands.html">8. 调用命令</a></li>
<li class="toctree-l3"><a class="reference internal" href="../shell/conclusion.html">9. 结论</a></li>
<li class="toctree-l3"><a class="reference internal" href="../shell/changelog.html">10. 变更日志</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../typescript/index.html">TypeScript 风格指南</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../typescript/syntax.html">1. 语法规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="../typescript/language.html">2. 语言特性</a></li>
<li class="toctree-l3"><a class="reference internal" href="../typescript/source_organization.html">3. 代码管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="../typescript/type_system.html">4. 类型系统</a></li>
<li class="toctree-l3"><a class="reference internal" href="../typescript/consistency.html">5. 一致性</a></li>
<li class="toctree-l3"><a class="reference internal" href="../typescript/changelog.html">6. 变更日志</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../javascript/index.html">Javascript 风格指南</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../javascript/background.html">1. 背景</a></li>
<li class="toctree-l3"><a class="reference internal" href="../javascript/javascript_language_rules.html">2. Javascript语言规范</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../CHANGES.html">变更</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">关于</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="python">
<h1><span class="section-number">2. </span>Python语言规范<a class="headerlink" href="#python" title="永久链接至标题">¶</a></h1>
<section id="lint">
<h2><span class="section-number">2.1. </span>Lint<a class="headerlink" href="#lint" title="永久链接至标题">¶</a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>使用该 <a class="reference external" href="https://google.github.io/styleguide/pylintrc">pylintrc</a> 对你的代码运行pylint</p>
</div>
<dl>
<dt>定义:</dt><dd><p>pylint是一个在Python源代码中查找bug的工具. 对于C和C++这样的不那么动态的(译者注: 原文是less dynamic)语言, 这些bug通常由编译器来捕获. 由于Python的动态特性, 有些警告可能不对. 不过伪告警应该很少.</p>
</dd>
<dt>优点:</dt><dd><p>可以捕获容易忽视的错误, 例如输入错误, 使用未赋值的变量等.</p>
</dd>
<dt>缺点:</dt><dd><p>pylint不完美. 要利用其优势, 我们有时侯需要: a) 围绕着它来写代码 b) 抑制其告警 c) 改进它, 或者d) 忽略它.</p>
</dd>
<dt>结论:</dt><dd><p>确保对你的代码运行pylint.
抑制不准确的警告,以便能够将其他警告暴露出来。你可以通过设置一个行注释来抑制警告. 例如:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">dict</span> <span class="o">=</span> <span class="s1">'something awful'</span>  <span class="c1"># Bad Idea... pylint: disable=redefined-builtin</span>
</pre></div>
</div>
<p>pylint警告是以符号名(如 <code class="docutils literal notranslate"><span class="pre">empty-docstring</span></code> )来标识的。google 特定的警告则是以 <code class="docutils literal notranslate"><span class="pre">g-</span></code> 开头.</p>
<p>如果警告的符号名不够见名知意，那么请对其增加一个详细解释。</p>
<p>采用这种抑制方式的好处是我们可以轻松查找抑制并回顾它们.</p>
<p>你可以使用命令 <code class="docutils literal notranslate"><span class="pre">pylint</span> <span class="pre">--list-msgs</span></code> 来获取pylint告警列表. 你可以使用命令 <code class="docutils literal notranslate"><span class="pre">pylint</span> <span class="pre">--help-msg=C6409</span></code> , 以获取关于特定消息的更多信息.</p>
<p>相比较于之前使用的 <code class="docutils literal notranslate"><span class="pre">pylint:</span> <span class="pre">disable-msg</span></code> , 本文推荐使用 <code class="docutils literal notranslate"><span class="pre">pylint:</span> <span class="pre">disable</span></code> .</p>
<p>在函数体中 <code class="docutils literal notranslate"><span class="pre">del</span></code> 未使用的变量可以消除参数未使用告警.记得要加一条注释说明你为何 <code class="docutils literal notranslate"><span class="pre">del</span></code> 它们,注释使用”Unused”就可以,例如:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">viking_cafe_order</span><span class="p">(</span><span class="n">spam</span><span class="p">,</span> <span class="n">beans</span><span class="p">,</span> <span class="n">eggs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">del</span> <span class="n">beans</span><span class="p">,</span> <span class="n">eggs</span>  <span class="c1"># Unused by vikings.</span>
    <span class="k">return</span> <span class="n">spam</span> <span class="o">+</span> <span class="n">spam</span> <span class="o">+</span> <span class="n">spam</span>
</pre></div>
</div>
<p>其他消除这个告警的方法还有使用`_`标志未使用参数,或者给这些参数名加上前缀 <code class="docutils literal notranslate"><span class="pre">unused_</span></code>, 或者直接把它们绑定到 <code class="docutils literal notranslate"><span class="pre">_</span></code>.但这些方法都不推荐.</p>
</dd>
</dl>
</section>
<section id="id1">
<h2><span class="section-number">2.2. </span>导入<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>仅对包和模块使用导入,而不单独导入函数或者类。<code class="docutils literal notranslate"><span class="pre">typing</span></code> 模块例外。</p>
</div>
<dl>
<dt>定义:</dt><dd><p>模块间共享代码的重用机制.</p>
</dd>
<dt>优点:</dt><dd><p>命名空间管理约定十分简单. 每个标识符的源都用一种一致的方式指示. x.Obj表示Obj对象定义在模块x中.</p>
</dd>
<dt>缺点:</dt><dd><p>模块名仍可能冲突. 有些模块名太长, 不太方便.</p>
</dd>
<dt>结论:</dt><dd><ol class="arabic simple">
<li><p>使用 <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">x</span></code> 来导入包和模块.</p></li>
<li><p>使用 <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">x</span> <span class="pre">import</span> <span class="pre">y</span></code> , 其中x是包前缀, y是不带前缀的模块名.</p></li>
<li><p>使用 <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">x</span> <span class="pre">import</span> <span class="pre">y</span> <span class="pre">as</span> <span class="pre">z</span></code>, 如果两个要导入的模块都叫做y或者y太长了.</p></li>
<li><p>仅当缩写 <code class="docutils literal notranslate"><span class="pre">z</span></code> 是通用缩写时才可使用 <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">y</span> <span class="pre">as</span> <span class="pre">z</span></code>.(比如 <code class="docutils literal notranslate"><span class="pre">np</span></code> 代表 <code class="docutils literal notranslate"><span class="pre">numpy</span></code>.)</p></li>
</ol>
<p>例如, 模块 <code class="docutils literal notranslate"><span class="pre">sound.effects.echo</span></code> 可以用如下方式导入:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sound.effects</span> <span class="kn">import</span> <span class="n">echo</span>
<span class="o">...</span>
<span class="n">echo</span><span class="o">.</span><span class="n">EchoFilter</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">atten</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>导入时不要使用相对名称. 即使模块在同一个包中, 也要使用完整包名. 这能帮助你避免无意间导入一个包两次.</p>
<p>导入 <code class="docutils literal notranslate"><span class="pre">typing</span></code> 和 <a class="reference external" href="https://six.readthedocs.io/#module-six.moves">six.moves</a> 模块时可以例外.</p>
</dd>
</dl>
</section>
<section id="id2">
<h2><span class="section-number">2.3. </span>包<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>使用模块的全路径名来导入每个模块</p>
</div>
<dl>
<dt>优点:</dt><dd><p>避免模块名冲突或是因非预期的模块搜索路径导致导入错误. 查找包更容易.</p>
</dd>
<dt>缺点:</dt><dd><p>部署代码变难, 因为你必须复制包层次.</p>
</dd>
<dt>结论:</dt><dd><p>所有的新代码都应该用完整包名来导入每个模块.</p>
<p>应该像下面这样导入:</p>
<p>yes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 在代码中引用完整名称 absl.flags (详细情况).</span>
<span class="kn">import</span> <span class="nn">absl.flags</span>
<span class="kn">from</span> <span class="nn">doctor.who</span> <span class="kn">import</span> <span class="n">jodie</span>

<span class="n">FLAGS</span> <span class="o">=</span> <span class="n">absl</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">FLAGS</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 在代码中仅引用模块名 flags (常见情况).</span>
<span class="kn">from</span> <span class="nn">absl</span> <span class="kn">import</span> <span class="n">flags</span>
<span class="kn">from</span> <span class="nn">doctor.who</span> <span class="kn">import</span> <span class="n">jodie</span>

<span class="n">FLAGS</span> <span class="o">=</span> <span class="n">flags</span><span class="o">.</span><span class="n">FLAGS</span>
</pre></div>
</div>
<p>No: (假设当前文件和 <cite>jodie.py</cite> 都在目录 <cite>doctor/who/</cite> 下)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 没能清晰指示出作者想要导入的模块和最终被导入的模块.</span>
<span class="c1"># 实际导入的模块将取决于 sys.path.</span>
<span class="kn">import</span> <span class="nn">jodie</span>
</pre></div>
</div>
<p>不应假定主入口脚本所在的目录就在 <cite>sys.path</cite> 中，虽然这种情况是存在的。当主入口脚本所在目录不在 <cite>sys.path</cite> 中时，代码将假设 <cite>import jodie</cite> 是导入的一个第三方库或者是一个名为 <cite>jodie</cite> 的顶层包，而不是本地的 <cite>jodie.py</cite></p>
</dd>
</dl>
</section>
<section id="id3">
<h2><span class="section-number">2.4. </span>异常<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>允许使用异常, 但必须小心</p>
</div>
<dl>
<dt>定义:</dt><dd><p>异常是一种跳出代码块的正常控制流来处理错误或者其它异常条件的方式.</p>
</dd>
<dt>优点:</dt><dd><p>正常操作代码的控制流不会和错误处理代码混在一起. 当某种条件发生时, 它也允许控制流跳过多个框架. 例如, 一步跳出N个嵌套的函数, 而不必继续执行错误的代码.</p>
</dd>
<dt>缺点:</dt><dd><p>可能会导致让人困惑的控制流. 调用库时容易错过错误情况.</p>
</dd>
<dt>结论:</dt><dd><p>异常必须遵守特定条件:</p>
<ol class="arabic">
<li><p>优先合理的使用内置异常类.比如 <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> 指示了一个程序错误, 比如在方法需要正数的情况下传递了一个负数错误.不要使用 <code class="docutils literal notranslate"><span class="pre">assert</span></code> 语句来验证公共API的参数值. <code class="docutils literal notranslate"><span class="pre">assert</span></code> 是用来保证内部正确性的,而不是用来强制纠正参数使用.若需要使用异常来指示某些意外情况,不要用 <code class="docutils literal notranslate"><span class="pre">assert</span></code>,用 <code class="docutils literal notranslate"><span class="pre">raise</span></code> 语句,例如:</p>
<blockquote>
<div><p>Yes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">connect_to_next_port</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minimum</span><span class="p">):</span>
    <span class="sd">"""Connects to the next available port.</span>

<span class="sd">    Args:</span>
<span class="sd">        minimum: A port value greater or equal to 1024.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The new minimum port.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConnectionError: If no available port is found.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">minimum</span> <span class="o">&lt;</span> <span class="mi">1024</span><span class="p">:</span>
        <span class="c1"># Note that this raising of ValueError is not mentioned in the doc</span>
        <span class="c1"># string's "Raises:" section because it is not appropriate to</span>
        <span class="c1"># guarantee this specific behavioral reaction to API misuse.</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Min. port must be at least 1024, not </span><span class="si">{</span><span class="n">minimum</span><span class="si">}</span><span class="s1">.'</span><span class="p">)</span>
    <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_next_open_port</span><span class="p">(</span><span class="n">minimum</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">port</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">'Could not connect to service on port </span><span class="si">{</span><span class="n">minimum</span><span class="si">}</span><span class="s1"> or higher.'</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">port</span> <span class="o">&gt;=</span> <span class="n">minimum</span><span class="p">,</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s1">'Unexpected port </span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s1"> when minimum was </span><span class="si">{</span><span class="n">minimum</span><span class="si">}</span><span class="s1">.'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">port</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">connect_to_next_port</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minimum</span><span class="p">):</span>
    <span class="sd">"""Connects to the next available port.</span>

<span class="sd">    Args:</span>
<span class="sd">    minimum: A port value greater or equal to 1024.</span>

<span class="sd">    Returns:</span>
<span class="sd">    The new minimum port.</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="n">minimum</span> <span class="o">&gt;=</span> <span class="mi">1024</span><span class="p">,</span> <span class="s1">'Minimum port must be at least 1024.'</span>
    <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_next_open_port</span><span class="p">(</span><span class="n">minimum</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">port</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">port</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>模块或包应该定义自己的特定域的异常基类, 这个基类应该从内建的Exception类继承. 模块的异常基类后缀应该叫做 <code class="docutils literal notranslate"><span class="pre">Error</span></code>.</p></li>
<li><p>永远不要使用 <code class="docutils literal notranslate"><span class="pre">except:</span></code> 语句来捕获所有异常, 也不要捕获 <code class="docutils literal notranslate"><span class="pre">Exception</span></code> 或者 <code class="docutils literal notranslate"><span class="pre">StandardError</span></code> , 除非你打算重新触发该异常, 或者你已经在当前线程的最外层(记得还是要打印一条错误消息). 在异常这方面, Python非常宽容, <code class="docutils literal notranslate"><span class="pre">except:</span></code> 真的会捕获包括Python语法错误在内的任何错误. 使用 <code class="docutils literal notranslate"><span class="pre">except:</span></code> 很容易隐藏真正的bug.</p></li>
<li><p>尽量减少try/except块中的代码量. try块的体积越大, 期望之外的异常就越容易被触发. 这种情况下, try/except块将隐藏真正的错误.</p></li>
<li><p>使用finally子句来执行那些无论try块中有没有异常都应该被执行的代码. 这对于清理资源常常很有用, 例如关闭文件.</p></li>
</ol>
</dd>
</dl>
</section>
<section id="id4">
<h2><span class="section-number">2.5. </span>全局变量<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>避免全局变量</p>
</div>
<dl class="simple">
<dt>定义:</dt><dd><p>定义在模块级的变量.</p>
</dd>
<dt>优点:</dt><dd><p>偶尔有用.</p>
</dd>
<dt>缺点:</dt><dd><p>导入时可能改变模块行为, 因为导入模块时会对模块级变量赋值.</p>
</dd>
<dt>结论:</dt><dd><p>避免使用全局变量。
鼓励使用模块级的常量，例如 <code class="docutils literal notranslate"><span class="pre">MAX_HOLY_HANDGRENADE_COUNT</span> <span class="pre">=</span> <span class="pre">3</span></code> 。注意常量命名必须全部大写,用 <code class="docutils literal notranslate"><span class="pre">_</span></code> 分隔.具体参见 <a class="reference external" href="s3.16-naming">命名规则</a>
若必须要使用全局变量，应在模块内声明全局变量,并在名称前 <code class="docutils literal notranslate"><span class="pre">_</span></code> 使之成为模块内部变量.外部访问必须通过模块级的公共函数.具体参见 <a class="reference external" href="s3.16-naming">命名规则</a></p>
</dd>
</dl>
</section>
<section id="id7">
<h2><span class="section-number">2.6. </span>嵌套/局部/内部类或函数<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>使用内部类或者嵌套函数可以用来覆盖某些局部变量.</p>
</div>
<dl class="simple">
<dt>定义:</dt><dd><p>类可以定义在方法, 函数或者类中. 函数可以定义在方法或函数中. 封闭区间中定义的变量对嵌套函数是只读的. (译者注:即内嵌函数可以读外部函数中定义的变量,但是无法改写,除非使用 <cite>nonlocal</cite>)</p>
</dd>
<dt>优点:</dt><dd><p>允许定义仅用于有效范围的工具类和函数.在装饰器中比较常用.</p>
</dd>
<dt>缺点:</dt><dd><p>嵌套类或局部类的实例不能序列化(pickled). 内嵌的函数和类无法直接测试.同时内嵌函数和类会使外部函数的可读性变差.</p>
</dd>
<dt>结论:</dt><dd><p>使用内部类或者内嵌函数可以忽视一些警告.但是应该避免使用内嵌函数或类,除非是想覆盖某些值.若想对模块的用户隐藏某个函数,不要采用嵌套它来隐藏,应该在需要被隐藏的方法的模块级名称加 <code class="docutils literal notranslate"><span class="pre">_</span></code> 前缀,这样它依然是可以被测试的.</p>
</dd>
</dl>
</section>
<section id="id8">
<h2><span class="section-number">2.7. </span>推导式&amp;生成式<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>可以在简单情况下使用</p>
</div>
<dl>
<dt>定义:</dt><dd><p>列表,字典和集合的推导&amp;生成式提供了一种简洁高效的方式来创建容器和迭代器, 而不必借助map(), filter(), 或者lambda.(译者注: 元组是没有推导式的, <code class="docutils literal notranslate"><span class="pre">()</span></code> 内加类似推导式的句式返回的是个生成器)</p>
</dd>
<dt>优点:</dt><dd><p>简单的列表推导可以比其它的列表创建方法更加清晰简单. 生成器表达式可以十分高效, 因为它们避免了创建整个列表.</p>
</dd>
<dt>缺点:</dt><dd><p>复杂的列表推导或者生成器表达式可能难以阅读.</p>
</dd>
<dt>结论:</dt><dd><p>适用于简单情况. 每个部分应该单独置于一行: 映射表达式, for语句, 过滤器表达式. 禁止多重for语句或过滤器表达式. 复杂情况下还是使用循环.</p>
<p>Yes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">mapping_expr</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">iterable</span> <span class="k">if</span> <span class="n">filter_expr</span><span class="p">]</span>

<span class="n">result</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">'key'</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">iterable</span>
            <span class="k">if</span> <span class="n">a_long_filter_expression</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span>

<span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">complicated_transform</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">iterable</span> <span class="k">if</span> <span class="n">predicate</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>

<span class="n">descriptive_name</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">transform</span><span class="p">({</span><span class="s1">'key'</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s1">'value'</span><span class="p">:</span> <span class="n">value</span><span class="p">},</span> <span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">generate_iterable</span><span class="p">(</span><span class="n">some_input</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">complicated_condition_is_met</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

<span class="k">return</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="n">complicated_transform</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">long_generator_function</span><span class="p">(</span><span class="n">parameter</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>

<span class="n">squares_generator</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

<span class="n">unique_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">user</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span> <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>

<span class="n">eat</span><span class="p">(</span><span class="n">jelly_bean</span> <span class="k">for</span> <span class="n">jelly_bean</span> <span class="ow">in</span> <span class="n">jelly_beans</span>
    <span class="k">if</span> <span class="n">jelly_bean</span><span class="o">.</span><span class="n">color</span> <span class="o">==</span> <span class="s1">'black'</span><span class="p">)</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">]</span>

<span class="k">return</span> <span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">y</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">y</span> <span class="o">!=</span> <span class="n">z</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="id9">
<h2><span class="section-number">2.8. </span>默认迭代器和操作符<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>如果类型支持, 就使用默认迭代器和操作符. 比如列表, 字典及文件等.</p>
</div>
<dl>
<dt>定义:</dt><dd><p>容器类型, 像字典和列表, 定义了默认的迭代器和关系测试操作符(in和not in)</p>
</dd>
<dt>优点:</dt><dd><p>默认操作符和迭代器简单高效, 它们直接表达了操作, 没有额外的方法调用. 使用默认操作符的函数是通用的. 它可以用于支持该操作的任何类型.</p>
</dd>
<dt>缺点:</dt><dd><p>你没法通过阅读方法名来区分对象的类型(例如, has_key()意味着字典). 不过这也是优点.</p>
</dd>
<dt>结论:</dt><dd><p>如果类型支持, 就使用默认迭代器和操作符, 例如列表, 字典和文件. 内建类型也定义了迭代器方法. 优先考虑这些方法, 而不是那些返回列表的方法. 当然，这样遍历容器时，你将不能修改容器. 除非必要,否则不要使用诸如 <cite>dict.iter*()</cite> 这类python2的特定迭代方法.</p>
<p>Yes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">adict</span><span class="p">:</span> <span class="o">...</span>
<span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">adict</span><span class="p">:</span> <span class="o">...</span>
<span class="k">if</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">alist</span><span class="p">:</span> <span class="o">...</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">afile</span><span class="p">:</span> <span class="o">...</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span> <span class="o">...</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">adict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="o">...</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">adict</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">key</span><span class="p">):</span> <span class="o">...</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">afile</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span> <span class="o">...</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="id10">
<h2><span class="section-number">2.9. </span>生成器<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>按需使用生成器.</p>
</div>
<dl>
<dt>定义:</dt><dd><p>所谓生成器函数, 就是每当它执行一次生成(yield)语句, 它就返回一个迭代器, 这个迭代器生成一个值. 生成值后, 生成器函数的运行状态将被挂起, 直到下一次生成.</p>
</dd>
<dt>优点:</dt><dd><p>简化代码, 因为每次调用时, 局部变量和控制流的状态都会被保存. 比起一次创建一系列值的函数, 生成器使用的内存更少.</p>
</dd>
<dt>缺点:</dt><dd><p>没有.</p>
</dd>
<dt>结论:</dt><dd><p>鼓励使用. 注意在生成器函数的文档字符串中使用”Yields:”而不是”Returns:”.</p>
<p>(译者注: 参看 <a class="reference internal" href="python_style_rules.html#comments"><span class="std std-ref">注释</span></a> )</p>
</dd>
</dl>
</section>
<section id="lambda">
<h2><span class="section-number">2.10. </span>Lambda函数<a class="headerlink" href="#lambda" title="永久链接至标题">¶</a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>适用于单行函数</p>
</div>
<dl>
<dt>定义:</dt><dd><p>与语句相反, lambda在一个表达式中定义匿名函数. 常用于为 <code class="docutils literal notranslate"><span class="pre">map()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">filter()</span></code> 之类的高阶函数定义回调函数或者操作符.</p>
</dd>
<dt>优点:</dt><dd><p>方便.</p>
</dd>
<dt>缺点:</dt><dd><p>比本地函数更难阅读和调试. 没有函数名意味着堆栈跟踪更难理解. 由于lambda函数通常只包含一个表达式, 因此其表达能力有限.</p>
</dd>
<dt>结论:</dt><dd><p>适用于单行函数. 如果代码超过60-80个字符, 最好还是定义成常规(嵌套)函数.</p>
<p>对于常见的操作符，例如乘法操作符，使用 <code class="docutils literal notranslate"><span class="pre">operator</span></code> 模块中的函数以代替lambda函数. 例如, 推荐使用 <code class="docutils literal notranslate"><span class="pre">operator.mul</span></code> , 而不是 <code class="docutils literal notranslate"><span class="pre">lambda</span> <span class="pre">x,</span> <span class="pre">y:</span> <span class="pre">x</span> <span class="pre">*</span> <span class="pre">y</span></code> .</p>
</dd>
</dl>
</section>
<section id="id11">
<h2><span class="section-number">2.11. </span>条件表达式<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>适用于单行函数</p>
</div>
<dl>
<dt>定义:</dt><dd><p>条件表达式(又名三元运算符)是对于if语句的一种更为简短的句法规则. 例如: <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">1</span> <span class="pre">if</span> <span class="pre">cond</span> <span class="pre">else</span> <span class="pre">2</span></code> .</p>
</dd>
<dt>优点:</dt><dd><p>比if语句更加简短和方便.</p>
</dd>
<dt>缺点:</dt><dd><p>比if语句难于阅读. 如果表达式很长， 难于定位条件.</p>
</dd>
<dt>结论:</dt><dd><p>适用于单行函数. 写法上推荐真实表达式,if表达式,else表达式每个独占一行.在其他情况下，推荐使用完整的if语句.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">one_line</span> <span class="o">=</span> <span class="s1">'yes'</span> <span class="k">if</span> <span class="n">predicate</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">else</span> <span class="s1">'no'</span>
<span class="n">slightly_split</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'yes'</span> <span class="k">if</span> <span class="n">predicate</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">else</span> <span class="s1">'no, nein, nyet'</span><span class="p">)</span>
<span class="n">the_longest_ternary_style_that_can_be_done</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s1">'yes, true, affirmative, confirmed, correct'</span>
    <span class="k">if</span> <span class="n">predicate</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">else</span> <span class="s1">'no, false, negative, nay'</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bad_line_breaking</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'yes'</span> <span class="k">if</span> <span class="n">predicate</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">else</span>
                <span class="s1">'no'</span><span class="p">)</span>
<span class="n">portion_too_long</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'yes'</span>
                    <span class="k">if</span> <span class="n">some_long_module</span><span class="o">.</span><span class="n">some_long_predicate_function</span><span class="p">(</span>
                        <span class="n">really_long_variable_name</span><span class="p">)</span>
                    <span class="k">else</span> <span class="s1">'no, false, negative, nay'</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="id12">
<h2><span class="section-number">2.12. </span>默认参数值<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>适用于大部分情况.</p>
</div>
<dl>
<dt>定义:</dt><dd><p>你可以在函数参数列表的最后指定变量的值, 例如, <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">foo(a,</span> <span class="pre">b</span> <span class="pre">=</span> <span class="pre">0):</span></code> . 如果调用foo时只带一个参数, 则b被设为0. 如果带两个参数, 则b的值等于第二个参数.</p>
</dd>
<dt>优点:</dt><dd><p>你经常会碰到一些使用大量默认值的函数, 但偶尔(比较少见)你想要覆盖这些默认值. 默认参数值提供了一种简单的方法来完成这件事, 你不需要为这些罕见的例外定义大量函数. 同时, Python也不支持重载方法和函数, 默认参数是一种”仿造”重载行为的简单方式.</p>
</dd>
<dt>缺点:</dt><dd><p>默认参数只在模块加载时求值一次. 如果参数是列表或字典之类的可变类型, 这可能会导致问题. 如果函数修改了对象(例如向列表追加项), 默认值就被修改了.</p>
</dd>
<dt>结论:</dt><dd><p>鼓励使用, 不过有如下注意事项:</p>
<p>不要在函数或方法定义中使用可变对象作为默认值.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Yes</span><span class="p">:</span> <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">b</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Yes</span><span class="p">:</span> <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">b</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Yes</span><span class="p">:</span> <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Sequence</span> <span class="o">=</span> <span class="p">()):</span>  <span class="c1"># Empty tuple OK since tuples are immutable</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">No</span><span class="p">:</span>  <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="p">[]):</span>
    <span class="o">...</span>
<span class="n">No</span><span class="p">:</span>  <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()):</span>  <span class="c1"># The time the module was loaded???</span>
    <span class="o">...</span>
<span class="n">No</span><span class="p">:</span>  <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">FLAGS</span><span class="o">.</span><span class="n">my_thing</span><span class="p">):</span>  <span class="c1"># sys.argv has not yet been parsed...</span>
    <span class="o">...</span>
<span class="n">No</span><span class="p">:</span>  <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Mapping</span> <span class="o">=</span> <span class="p">{}):</span>  <span class="c1"># Could still get passed to unchecked code</span>
    <span class="o">...</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="properties">
<h2><span class="section-number">2.13. </span>特性(properties)<a class="headerlink" href="#properties" title="永久链接至标题">¶</a></h2>
<p>(译者注:参照fluent python.这里将 “property” 译为”特性”,而 “attribute” 译为属性. python中数据的属性和处理数据的方法统称属性”(arrtibute)”, 而在不改变类接口的前提下用来修改数据属性的存取方法我们称为”特性(property)”.)</p>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>访问和设置数据成员时, 你通常会使用简单, 轻量级的访问和设置函数.建议使用特性(properties)来代替它们.</p>
</div>
<dl>
<dt>定义:</dt><dd><p>一种用于包装方法调用的方式. 当运算量不大, 它是获取和设置属性(attribute)的标准方式.</p>
</dd>
<dt>优点:</dt><dd><p>通过消除简单的属性(attribute)访问时显式的get和set方法调用, 可读性提高了. 允许懒惰的计算. 用Pythonic的方式来维护类的接口. 就性能而言, 当直接访问变量是合理的, 添加访问方法就显得琐碎而无意义. 使用特性(properties)可以绕过这个问题. 将来也可以在不破坏接口的情况下将访问方法加上.</p>
</dd>
<dt>缺点:</dt><dd><p>特性(properties)是在get和set方法声明后指定, 这需要使用者在接下来的代码中注意: set和get是用于特性(properties)的(除了用 <code class="docutils literal notranslate"><span class="pre">@property</span></code> 装饰器创建的只读属性).  必须继承自object类. 可能隐藏比如操作符重载之类的副作用. 继承时可能会让人困惑.
(译者注:这里没有修改原始翻译,其实就是 @property 装饰器是不会被继承的)</p>
</dd>
<dt>结论:</dt><dd><p>你通常习惯于使用访问或设置方法来访问或设置数据, 它们简单而轻量. 不过我们建议你在新的代码中使用属性. 只读属性应该用 <code class="docutils literal notranslate"><span class="pre">@property</span></code> <a class="reference external" href="http://google-styleguide.googlecode.com/svn/trunk/pyguide.html#Function_and_Method_Decorators">装饰器</a> 来创建.</p>
<p>如果子类没有覆盖属性, 那么属性的继承可能看上去不明显. 因此使用者必须确保访问方法间接被调用, 以保证子类中的重载方法被属性调用(使用模板方法设计模式).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Yes</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">math</span>

    <span class="k">class</span> <span class="nc">Square</span><span class="p">:</span>
        <span class="sd">"""A square with two properties: a writable area and a read-only perimeter.</span>

<span class="sd">        To use:</span>
<span class="sd">        &gt;&gt;&gt; sq = Square(3)</span>
<span class="sd">        &gt;&gt;&gt; sq.area</span>
<span class="sd">        9</span>
<span class="sd">        &gt;&gt;&gt; sq.perimeter</span>
<span class="sd">        12</span>
<span class="sd">        &gt;&gt;&gt; sq.area = 16</span>
<span class="sd">        &gt;&gt;&gt; sq.side</span>
<span class="sd">        4</span>
<span class="sd">        &gt;&gt;&gt; sq.perimeter</span>
<span class="sd">        16</span>
<span class="sd">        """</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">side</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">side</span> <span class="o">=</span> <span class="n">side</span>

        <span class="nd">@property</span>
        <span class="k">def</span> <span class="nf">area</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">"""Area of the square."""</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_area</span><span class="p">()</span>

        <span class="nd">@area</span><span class="o">.</span><span class="n">setter</span>
        <span class="k">def</span> <span class="nf">area</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">area</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_area</span><span class="p">(</span><span class="n">area</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_get_area</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">"""Indirect accessor to calculate the 'area' property."""</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">side</span> <span class="o">**</span> <span class="mi">2</span>

        <span class="k">def</span> <span class="nf">_set_area</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">area</span><span class="p">):</span>
            <span class="sd">"""Indirect setter to set the 'area' property."""</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">side</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">area</span><span class="p">)</span>

        <span class="nd">@property</span>
        <span class="k">def</span> <span class="nf">perimeter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">side</span> <span class="o">*</span> <span class="mi">4</span>
</pre></div>
</div>
<p>(译者注: 老实说, 我觉得这段示例代码很不恰当, 有必要这么蛋疼吗?)</p>
</dd>
</dl>
</section>
<section id="true-false">
<h2><span class="section-number">2.14. </span>True/False的求值<a class="headerlink" href="#true-false" title="永久链接至标题">¶</a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>尽可能使用隐式false</p>
</div>
<dl>
<dt>定义:</dt><dd><p>Python在布尔上下文中会将某些值求值为false. 按简单的直觉来讲, 就是所有的”空”值都被认为是false. 因此0， None, [], {}, “” 都被认为是false.</p>
</dd>
<dt>优点:</dt><dd><p>使用Python布尔值的条件语句更易读也更不易犯错. 大部分情况下, 也更快.</p>
</dd>
<dt>缺点:</dt><dd><p>对C/C++开发人员来说, 可能看起来有点怪.</p>
</dd>
<dt>结论:</dt><dd><p>尽可能使用隐式的false, 例如: 使用 <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">foo:</span></code> 而不是 <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">foo</span> <span class="pre">!=</span> <span class="pre">[]:</span></code> . 不过还是有一些注意事项需要你铭记在心:</p>
<ol class="arabic">
<li><dl class="simple">
<dt>对于 <code class="docutils literal notranslate"><span class="pre">None</span></code> 等单例对象测试时,使用 <code class="docutils literal notranslate"><span class="pre">is</span></code> 或者 <code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">not</span></code>.当你要测试一个默认值是None的变量或参数是否被设为其它值. 这个值在布尔语义下可能是false!</dt><dd><p>(译者注: <code class="docutils literal notranslate"><span class="pre">is</span></code> 比较的是对象的id(), 这个函数返回的通常是对象的内存地址,考虑到CPython的对象重用机制,可能会出现生命周不重叠的两个对象会有相同的id)</p>
</dd>
</dl>
</li>
<li><p>永远不要用==将一个布尔量与false相比较. 使用 <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">not</span> <span class="pre">x:</span></code> 代替. 如果你需要区分false和None, 你应该用像 <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">not</span> <span class="pre">x</span> <span class="pre">and</span> <span class="pre">x</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">None:</span></code> 这样的语句.</p></li>
<li><p>对于序列(字符串, 列表, 元组), 要注意空序列是false. 因此 <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">not</span> <span class="pre">seq:</span></code> 或者 <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">seq:</span></code> 比 <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">len(seq):</span></code> 或 <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">not</span> <span class="pre">len(seq):</span></code> 要更好.</p></li>
<li><p>处理整数时, 使用隐式false可能会得不偿失(即不小心将None当做0来处理). 你可以将一个已知是整型(且不是len()的返回结果)的值与0比较.</p>
<blockquote>
<div><p>Yes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="ow">not</span> <span class="n">users</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'no users'</span><span class="p">)</span>

<span class="k">if</span> <span class="n">foo</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">handle_zero</span><span class="p">()</span>

<span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">handle_multiple_of_ten</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">users</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s1">'no users'</span>

<span class="k">if</span> <span class="n">foo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">foo</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">handle_zero</span><span class="p">()</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">10</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">handle_multiple_of_ten</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="ow">or</span> <span class="p">[]</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>注意’0’(字符串)会被当做true.</p></li>
</ol>
</dd>
</dl>
</section>
<section id="id14">
<h2><span class="section-number">2.15. </span>过时的语言特性<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>尽可能使用字符串方法取代字符串模块. 使用函数调用语法取代apply(). 使用列表推导, for循环取代filter(), map()以及reduce().</p>
</div>
<dl>
<dt>定义:</dt><dd><p>当前版本的Python提供了大家通常更喜欢的替代品.</p>
</dd>
<dt>结论:</dt><dd><p>我们不使用不支持这些特性的Python版本, 所以没理由不用新的方式.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Yes</span><span class="p">:</span> <span class="n">words</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">':'</span><span class="p">)</span>

     <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">my_list</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5</span><span class="p">]</span>

     <span class="nb">map</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>    <span class="c1"># Ok. No inlined lambda expression.</span>

     <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">No</span><span class="p">:</span>  <span class="n">words</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="s1">':'</span><span class="p">)</span>

     <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5</span><span class="p">,</span> <span class="n">my_list</span><span class="p">))</span>

     <span class="n">apply</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="lexical-scoping">
<h2><span class="section-number">2.16. </span>词法作用域(Lexical Scoping)<a class="headerlink" href="#lexical-scoping" title="永久链接至标题">¶</a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>推荐使用</p>
</div>
<dl>
<dt>定义:</dt><dd><p>嵌套的Python函数可以引用外层函数中定义的变量, 但是不能够对它们赋值. 变量绑定的解析是使用词法作用域, 也就是基于静态的程序文本. 对一个块中的某个名称的任何赋值都会导致Python将对该名称的全部引用当做局部变量, 甚至是赋值前的处理. 如果碰到global声明, 该名称就会被视作全局变量.</p>
<p>一个使用这个特性的例子:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_adder</span><span class="p">(</span><span class="n">summand1</span><span class="p">):</span>
    <span class="sd">"""Returns a function that adds numbers to a given number."""</span>
    <span class="k">def</span> <span class="nf">adder</span><span class="p">(</span><span class="n">summand2</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">summand1</span> <span class="o">+</span> <span class="n">summand2</span>

    <span class="k">return</span> <span class="n">adder</span>
</pre></div>
</div>
<p>(译者注: 这个例子有点诡异, 你应该这样使用这个函数: <code class="docutils literal notranslate"><span class="pre">sum</span> <span class="pre">=</span> <span class="pre">get_adder(summand1)(summand2)</span></code> )</p>
</dd>
<dt>优点:</dt><dd><p>通常可以带来更加清晰, 优雅的代码. 尤其会让有经验的Lisp和Scheme(还有Haskell, ML等)程序员感到欣慰.</p>
</dd>
<dt>缺点:</dt><dd><p>可能导致让人迷惑的bug. 例如下面这个依据 <a class="reference external" href="http://www.python.org/dev/peps/pep-0227/">PEP-0227</a> 的例子:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">i</span> <span class="o">=</span> <span class="mi">4</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">bar</span><span class="p">():</span>
        <span class="nb">print</span> <span class="n">i</span><span class="p">,</span>
    <span class="c1"># ...</span>
    <span class="c1"># A bunch of code here</span>
    <span class="c1"># ...</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>  <span class="c1"># Ah, i *is* local to Foo, so this is what Bar sees</span>
        <span class="nb">print</span> <span class="n">i</span><span class="p">,</span>
    <span class="n">bar</span><span class="p">()</span>
</pre></div>
</div>
<p>因此 <code class="docutils literal notranslate"><span class="pre">foo([1,</span> <span class="pre">2,</span> <span class="pre">3])</span></code> 会打印 <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">2</span> <span class="pre">3</span> <span class="pre">3</span></code> , 不是 <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">2</span> <span class="pre">3</span> <span class="pre">4</span></code> .</p>
<p>(译者注: x是一个列表, for循环其实是将x中的值依次赋给i.这样对i的赋值就隐式的发生了, 整个foo函数体中的i都会被当做局部变量, 包括bar()中的那个. 这一点与C++之类的静态语言还是有很大差别的.)</p>
</dd>
<dt>结论:</dt><dd><p>鼓励使用.</p>
</dd>
</dl>
</section>
<section id="id15">
<h2><span class="section-number">2.17. </span>函数与方法装饰器<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>如果好处很显然, 就明智而谨慎的使用装饰器,避免使用 <code class="docutils literal notranslate"><span class="pre">staticmethod``以及谨慎使用``classmethod</span></code>.</p>
</div>
<dl>
<dt>定义:</dt><dd><p><a class="reference external" href="https://docs.python.org/release/2.4.3/whatsnew/node6.html">用于函数及方法的装饰器</a> (也就是@标记). 最常见的装饰器是@classmethod 和@staticmethod, 用于将常规函数转换成类方法或静态方法. 不过, 装饰器语法也允许用户自定义装饰器. 特别地, 对于某个函数 <code class="docutils literal notranslate"><span class="pre">my_decorator</span></code> , 下面的两段代码是等效的:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
   <span class="nd">@my_decorator</span>
   <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
       <span class="c1"># method body ...</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># method body ...</span>
    <span class="n">method</span> <span class="o">=</span> <span class="n">my_decorator</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt>优点:</dt><dd><p>优雅的在函数上指定一些转换. 该转换可能减少一些重复代码, 保持已有函数不变(enforce invariants), 等.</p>
</dd>
<dt>缺点:</dt><dd><p>装饰器可以在函数的参数或返回值上执行任何操作, 这可能导致让人惊异的隐藏行为. 而且, 装饰器在导入时执行. 从装饰器代码中捕获错误并处理是很困难的.</p>
</dd>
<dt>结论:</dt><dd><p>如果好处很显然, 就明智而谨慎的使用装饰器. 装饰器应该遵守和函数一样的导入和命名规则. 装饰器的python文档应该清晰的说明该函数是一个装饰器. 请为装饰器编写单元测试.</p>
<p>避免装饰器自身对外界的依赖(即不要依赖于文件, socket, 数据库连接等), 因为装饰器运行时这些资源可能不可用(由 <code class="docutils literal notranslate"><span class="pre">pydoc</span></code> 或其它工具导入). 应该保证一个用有效参数调用的装饰器在所有情况下都是成功的.</p>
<p>装饰器是一种特殊形式的”顶级代码”. 参考后面关于 <a class="reference internal" href="python_style_rules.html#main"><span class="std std-ref">Main</span></a> 的话题.</p>
<p>除非是为了将方法和现有的API集成，否则不要使用 <code class="docutils literal notranslate"><span class="pre">staticmethod</span></code> .多数情况下，将方法封装成模块级的函数可以达到同样的效果.</p>
<p>谨慎使用 <code class="docutils literal notranslate"><span class="pre">classmethod</span></code> .通常只在定义备选构造函数，或者写用于修改诸如进程级缓存等必要的全局状态的特定类方法才用。</p>
</dd>
</dl>
</section>
<section id="id17">
<h2><span class="section-number">2.18. </span>线程<a class="headerlink" href="#id17" title="永久链接至标题">¶</a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>不要依赖内建类型的原子性.</p>
</div>
<p>虽然Python的内建类型例如字典看上去拥有原子操作, 但是在某些情形下它们仍然不是原子的(即: 如果__hash__或__eq__被实现为Python方法)且它们的原子性是靠不住的. 你也不能指望原子变量赋值(因为这个反过来依赖字典).</p>
<p>优先使用Queue模块的 <code class="docutils literal notranslate"><span class="pre">Queue</span></code> 数据类型作为线程间的数据通信方式. 另外, 使用threading模块及其锁原语(locking primitives). 了解条件变量的合适使用方式, 这样你就可以使用 <code class="docutils literal notranslate"><span class="pre">threading.Condition</span></code> 来取代低级别的锁了.</p>
</section>
<section id="id18">
<h2><span class="section-number">2.19. </span>威力过大的特性<a class="headerlink" href="#id18" title="永久链接至标题">¶</a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>避免使用这些特性</p>
</div>
<dl>
<dt>定义:</dt><dd><p>Python是一种异常灵活的语言, 它为你提供了很多花哨的特性, 诸如元类(metaclasses), 字节码访问, 任意编译(on-the-fly compilation), 动态继承, 对象父类重定义(object reparenting), 导入黑客(import hacks), 反射, 系统内修改(modification of system internals), 等等.</p>
</dd>
<dt>优点:</dt><dd><p>强大的语言特性, 能让你的代码更紧凑.</p>
</dd>
<dt>缺点:</dt><dd><p>使用这些很”酷”的特性十分诱人, 但不是绝对必要. 使用奇技淫巧的代码将更加难以阅读和调试. 开始可能还好(对原作者而言), 但当你回顾代码, 它们可能会比那些稍长一点但是很直接的代码更加难以理解.</p>
</dd>
<dt>结论:</dt><dd><p>在你的代码中避免这些特性.</p>
<p>当然，利用了这些特性的来编写的一些标准库是值得去使用的，比如 <code class="docutils literal notranslate"><span class="pre">abc.ABCMeta</span></code>, <code class="docutils literal notranslate"><span class="pre">collection.namedtuple</span></code>, <code class="docutils literal notranslate"><span class="pre">dataclasses</span></code> , <code class="docutils literal notranslate"><span class="pre">enum</span></code> 等.</p>
</dd>
</dl>
</section>
<section id="python-python3-from-future-imports">
<h2><span class="section-number">2.20. </span>现代python: python3 和from __future__ imports<a class="headerlink" href="#python-python3-from-future-imports" title="永久链接至标题">¶</a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>尽量使用 python3,  即使使用非 python3 写的代码.也应该尽量兼容.</p>
</div>
<dl>
<dt>定义:</dt><dd><p>python3 是 python 的一个重大变化,虽然已有大量代码是 python2.7 写的,但是通过一些简单的调整,就可以使之在 python3 下运行.</p>
</dd>
<dt>优点:</dt><dd><p>只要确定好项目的所有依赖,那么用 python3 写代码可以更加清晰和方便运行.</p>
</dd>
<dt>缺点:</dt><dd><p>导入一些看上去实际用不到的模块到代码里显得有些奇葩.</p>
</dd>
<dt>结论:</dt><dd><p><strong>from __future__ imports</strong></p>
<p>鼓励使用 <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span></code> 语句,所有的新代码都应该包含以下内容,并尽可能的与之兼容:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
</pre></div>
</div>
<p>以上导入的详情参见 <a class="reference external" href="https://www.python.org/dev/peps/pep-0328/">absolute imports</a> , <a class="reference external" href="https://www.python.org/dev/peps/pep-0238/">division behavior</a>, <a class="reference external" href="https://www.python.org/dev/peps/pep-3105/">print function</a> .
除非代码是只在python3下运行,否则不要删除以上导入.最好在所有文件里都保留这样的导入,这样若有人用到了这些方法时,编辑时不会忘记导入.
还有其他的一些来自 <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">__future__</span></code> 的语句.请在你认为合适的地方使用它们.本文没有推荐 <code class="docutils literal notranslate"><span class="pre">unicode_literals</span></code> ,因为我们认为它不是很棒的改进,它在 python2.7 中大量引入例隐式的默认编码转换.大多数情况下还是推荐显式的使用 <code class="docutils literal notranslate"><span class="pre">b</span></code> 和 <code class="docutils literal notranslate"><span class="pre">u</span></code> 以及 unicode字符串来显式的指示编码转换.</p>
<p><strong>six,future,past</strong></p>
<blockquote>
<div><p>当项目需要同时支持 python2 和 python3 时,请根据需要使用 <a class="reference external" href="https://pypi.org/project/six/">six</a> , <a class="reference external" href="https://pypi.org/project/future/">future</a> , <a class="reference external" href="https://pypi.org/project/past/">past</a> . 这些库可以使代码更加清晰和简单.</p>
</div></blockquote>
</dd>
</dl>
</section>
<section id="id19">
<h2><span class="section-number">2.21. </span>代码类型注释<a class="headerlink" href="#id19" title="永久链接至标题">¶</a></h2>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>你可以根据 <a class="reference external" href="https://www.python.org/dev/peps/pep-0484/">PEP-484</a> 来对 python3 代码进行注释,并使用诸如 <a class="reference external" href="https://github.com/google/pytype">pytype</a> 之类的类型检查工具来检查代码.
类型注释既可以写在源码,也可以写在 <a class="reference external" href="https://www.python.org/dev/peps/pep-0484/#stub-files">pyi</a> 中.推荐尽量写在源码里,对于第三方扩展包,可以写在pyi文件里.</p>
</div>
<dl>
<dt>定义:</dt><dd><p>用于函数参数和返回值的类型注释:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</pre></div>
</div>
<p>也可以使用 <a class="reference external" href="https://www.python.org/dev/peps/pep-0526/">PEP-526</a> 中的语法来声明变量类型:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="p">:</span> <span class="n">SomeType</span> <span class="o">=</span> <span class="n">some_func</span><span class="p">()</span>
</pre></div>
</div>
<p>在必须支持老版本 python 运行的代码中则可以这样注释:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">some_func</span><span class="p">()</span> <span class="c1">#type: SomeType</span>
</pre></div>
</div>
</dd>
<dt>优点:</dt><dd><p>可以提高代码可读性和可维护性.同时一些类型检查器可以帮您提早发现一些运行时错误,并降低您使用大威力特性的必要.</p>
</dd>
<dt>缺点:</dt><dd><p>必须时常更新类型声明.过时的类型声明可能会误导您.使用类型检查器会抑制您使用大威力特性.</p>
</dd>
<dt>结论:</dt><dd><p>强烈推荐您在更新代码时使用 python 类型分析.在添加或修改公共API时使用类型注释,在最终构建整个项目前使用 pytype 来进行检查.由于静态分析对于 python 来说还不够成熟,因此可能会出现一些副作用(例如错误推断的类型)可能会阻碍项目的部署.在这种情况下,建议作者添加一个 TODO 注释或者链接,来描述当前构建文件或是代码本身中使用类型注释导致的问题.</p>
<p>(译者注: 代码类型注释在帮助IDE或是vim等进行补全倒是很有效)</p>
</dd>
</dl>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="python_style_rules.html">
              <div class="page-info">
                <div class="context">
                  <span>下一页</span>
                </div>
                <div class="title"><span class="section-number">3. </span>Python 风格规范</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="background.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>上一页</span>
                </div>
                
                <div class="title"><span class="section-number">1. </span>背景</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2021, xinetzone |
          Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
          <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            | <a class="muted-link" href="../../_sources/google/python/python_language_rules.rst.txt"
               rel="nofollow">
              显示源代码
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            目录
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">2. Python语言规范</a><ul>
<li><a class="reference internal" href="#lint">2.1. Lint</a></li>
<li><a class="reference internal" href="#id1">2.2. 导入</a></li>
<li><a class="reference internal" href="#id2">2.3. 包</a></li>
<li><a class="reference internal" href="#id3">2.4. 异常</a></li>
<li><a class="reference internal" href="#id4">2.5. 全局变量</a></li>
<li><a class="reference internal" href="#id7">2.6. 嵌套/局部/内部类或函数</a></li>
<li><a class="reference internal" href="#id8">2.7. 推导式&amp;生成式</a></li>
<li><a class="reference internal" href="#id9">2.8. 默认迭代器和操作符</a></li>
<li><a class="reference internal" href="#id10">2.9. 生成器</a></li>
<li><a class="reference internal" href="#lambda">2.10. Lambda函数</a></li>
<li><a class="reference internal" href="#id11">2.11. 条件表达式</a></li>
<li><a class="reference internal" href="#id12">2.12. 默认参数值</a></li>
<li><a class="reference internal" href="#properties">2.13. 特性(properties)</a></li>
<li><a class="reference internal" href="#true-false">2.14. True/False的求值</a></li>
<li><a class="reference internal" href="#id14">2.15. 过时的语言特性</a></li>
<li><a class="reference internal" href="#lexical-scoping">2.16. 词法作用域(Lexical Scoping)</a></li>
<li><a class="reference internal" href="#id15">2.17. 函数与方法装饰器</a></li>
<li><a class="reference internal" href="#id17">2.18. 线程</a></li>
<li><a class="reference internal" href="#id18">2.19. 威力过大的特性</a></li>
<li><a class="reference internal" href="#python-python3-from-future-imports">2.20. 现代python: python3 和from __future__ imports</a></li>
<li><a class="reference internal" href="#id19">2.21. 代码类型注释</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/scripts/furo.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/tabs.js"></script>
    <script src="../../_static/translations.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    </body>
</html>